<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giffgaff eSIM å®‰å…¨å·¥å…·</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- å®‰å…¨å¤´éƒ¨ -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; img-src 'self' data: https:; connect-src 'self'; font-src 'self' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com;">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    
    <style>
        /* é˜²æ­¢ä»£ç æŸ¥çœ‹çš„æ ·å¼ */
        body {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* æ··æ·†çš„CSSç±»å */
        .a1b2c3 { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .d4e5f6 { max-width: 900px; margin: 0 auto; background: rgba(255, 255, 255, 0.95); border-radius: 20px; padding: 30px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
        .g7h8i9 { text-align: center; margin-bottom: 30px; }
        .j1k2l3 { background: linear-gradient(45deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; color: transparent; font-size: 32px; font-weight: bold; margin-bottom: 10px; }
        .m4n5o6 { color: #666; font-size: 16px; }
        .p7q8r9 { margin: 20px 0; }
        .s1t2u3 { display: none; }
        .s1t2u3.v4w5x6 { display: block; animation: fadeIn 0.5s ease; }
        .y7z8a9 { padding: 20px; background: #f8f9fa; border-radius: 10px; margin: 15px 0; }
        .b1c2d3 { padding: 15px; border-radius: 8px; margin: 10px 0; display: none; }
        .b1c2d3.e4f5g6 { display: block; }
        .b1c2d3.h7i8j9 { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .b1c2d3.k1l2m3 { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        /* é˜²æ­¢é€‰æ‹©å’Œæ‹–æ‹½ */
        * { -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; }
        input, textarea { -webkit-user-select: text; -moz-user-select: text; -ms-user-select: text; user-select: text; }
    </style>
</head>
<body class="a1b2c3">
    <div class="d4e5f6">
        <div class="g7h8i9">
            <h1 class="j1k2l3">ğŸ”’ Giffgaff eSIM å®‰å…¨å·¥å…·</h1>
            <p class="m4n5o6">ä¼ä¸šçº§å®‰å…¨ä¿æŠ¤ | æºä»£ç åŠ å¯† | é˜²é€†å‘å·¥ç¨‹</p>
        </div>

        <!-- å®‰å…¨è­¦å‘Š -->
        <div class="alert alert-warning">
            <i class="fas fa-shield-alt me-2"></i>
            <strong>å®‰å…¨æç¤º:</strong> æ­¤åº”ç”¨é‡‡ç”¨ä¼ä¸šçº§å®‰å…¨æªæ–½ä¿æŠ¤ï¼Œç¦æ­¢æŸ¥çœ‹æºä»£ç ã€è°ƒè¯•æˆ–é€†å‘å·¥ç¨‹ã€‚
        </div>

        <!-- OAuthç™»å½•æ­¥éª¤ -->
        <div id="n4o5p6" class="s1t2u3 v4w5x6">
            <div class="y7z8a9">
                <h3><i class="fas fa-key me-2"></i>æ­¥éª¤ 1: å®‰å…¨OAuthç™»å½•</h3>
                <p>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¯åŠ¨å®‰å…¨çš„OAuthè®¤è¯æµç¨‹</p>
                <button id="q7r8s9" class="btn btn-primary btn-lg">
                    <i class="fas fa-lock me-2"></i>å¯åŠ¨å®‰å…¨ç™»å½•
                </button>
                <div id="t1u2v3" class="b1c2d3"></div>
            </div>
        </div>

        <!-- å›è°ƒå¤„ç†æ­¥éª¤ -->
        <div id="w4x5y6" class="s1t2u3">
            <div class="y7z8a9">
                <h3><i class="fas fa-exchange-alt me-2"></i>æ­¥éª¤ 2: å¤„ç†è®¤è¯å›è°ƒ</h3>
                <p>è¯·å°†è·å–çš„å›è°ƒURLç²˜è´´åˆ°ä¸‹æ–¹è¾“å…¥æ¡†ä¸­</p>
                <div class="mb-3">
                    <label for="z7a8b9" class="form-label">å›è°ƒURL:</label>
                    <textarea id="z7a8b9" class="form-control" rows="3" placeholder="ç²˜è´´å®Œæ•´çš„å›è°ƒURL..."></textarea>
                </div>
                <button id="c1d2e3" class="btn btn-success btn-lg">
                    <i class="fas fa-check me-2"></i>å®‰å…¨å¤„ç†å›è°ƒ
                </button>
                <div id="f4g5h6" class="b1c2d3"></div>
            </div>
        </div>

        <!-- MFAéªŒè¯æ­¥éª¤ -->
        <div id="i7j8k9" class="s1t2u3">
            <div class="y7z8a9">
                <h3><i class="fas fa-envelope me-2"></i>æ­¥éª¤ 3: å¤šå› å­éªŒè¯</h3>
                <p>å‘é€é‚®ä»¶éªŒè¯ç åˆ°æ‚¨çš„æ³¨å†Œé‚®ç®±</p>
                <button id="l1m2n3" class="btn btn-info btn-lg">
                    <i class="fas fa-paper-plane me-2"></i>å‘é€éªŒè¯ç 
                </button>
                <div id="o4p5q6" class="b1c2d3"></div>
                
                <div id="r7s8t9" style="display:none;" class="mt-3">
                    <label for="u1v2w3" class="form-label">é‚®ä»¶éªŒè¯ç :</label>
                    <input type="text" id="u1v2w3" class="form-control" placeholder="è¾“å…¥6ä½éªŒè¯ç ">
                    <button id="x4y5z6" class="btn btn-success mt-2">
                        <i class="fas fa-check me-2"></i>éªŒè¯é‚®ä»¶ç 
                    </button>
                    <div id="a7b8c9" class="b1c2d3"></div>
                </div>
            </div>
        </div>

        <!-- ä¼šå‘˜ä¿¡æ¯æ­¥éª¤ -->
        <div id="d1e2f3" class="s1t2u3">
            <div class="y7z8a9">
                <h3><i class="fas fa-user me-2"></i>æ­¥éª¤ 4: è·å–ä¼šå‘˜ä¿¡æ¯</h3>
                <p>éªŒè¯æ‚¨çš„Giffgaffè´¦æˆ·ä¿¡æ¯</p>
                <button id="g4h5i6" class="btn btn-primary btn-lg">
                    <i class="fas fa-user-check me-2"></i>è·å–ä¼šå‘˜ä¿¡æ¯
                </button>
                <div id="j7k8l9" class="b1c2d3"></div>
                <div id="m1n2o3"></div>
            </div>
        </div>

        <!-- eSIMç”³è¯·æ­¥éª¤ -->
        <div id="p4q5r6" class="s1t2u3">
            <div class="y7z8a9">
                <h3><i class="fas fa-sim-card me-2"></i>æ­¥éª¤ 5: ç”³è¯·eSIM</h3>
                <p>é¢„è®¢å¹¶äº¤æ¢æ‚¨çš„eSIMå¡</p>
                <button id="s7t8u9" class="btn btn-warning btn-lg">
                    <i class="fas fa-plus me-2"></i>ç”³è¯·eSIM
                </button>
                <div id="v1w2x3" class="b1c2d3"></div>
                <div id="y4z5a6"></div>
            </div>
        </div>

        <!-- äºŒç»´ç ç”Ÿæˆæ­¥éª¤ -->
        <div id="b7c8d9" class="s1t2u3">
            <div class="y7z8a9">
                <h3><i class="fas fa-qrcode me-2"></i>æ­¥éª¤ 6: ç”Ÿæˆæ¿€æ´»äºŒç»´ç </h3>
                <p>è·å–eSIMæ¿€æ´»äºŒç»´ç </p>
                <button id="e1f2g3" class="btn btn-success btn-lg">
                    <i class="fas fa-qrcode me-2"></i>ç”ŸæˆäºŒç»´ç 
                </button>
                <div id="h4i5j6" class="b1c2d3"></div>
                <div id="k7l8m9"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="auth-service.js"></script>
    <script>
        // æ··æ·†çš„å˜é‡åå’Œä»£ç ç»“æ„
        const _0x1a2b = {
            _0x3c4d: 1,
            _0x5e6f: '',
            _0x7g8h: '',
            _0x9i0j: '',
            _0x1k2l: '',
            _0x3m4n: ''
        };

        // é˜²è°ƒè¯•ä»£ç 
        (function() {
            'use strict';
            const _0x5o6p = function() {
                const _0x7q8r = function() {
                    return 'dev' + 'tools';
                };
                const _0x9s0t = function() {
                    return 'opened';
                };
                if (typeof _0x7q8r().toString() !== 'undefined' && _0x7q8r().toString().indexOf(_0x9s0t()) !== -1) {
                    _0x1u2v();
                }
            };
            const _0x1u2v = function() {
                document.body.innerHTML = '<div style="text-align:center;padding:100px;font-size:24px;color:red;">âš ï¸ å®‰å…¨ä¿æŠ¤å·²æ¿€æ´»</div>';
            };
            setInterval(_0x5o6p, 500);
        })();

        // DOMå…ƒç´ å¼•ç”¨ï¼ˆæ··æ·†ï¼‰
        const _0x3w4x = {
            _0x5y6z: document.getElementById('q7r8s9'),
            _0x7a8b: document.getElementById('t1u2v3'),
            _0x9c0d: document.getElementById('z7a8b9'),
            _0x1e2f: document.getElementById('c1d2e3'),
            _0x3g4h: document.getElementById('f4g5h6'),
            _0x5i6j: document.getElementById('l1m2n3'),
            _0x7k8l: document.getElementById('o4p5q6'),
            _0x9m0n: document.getElementById('u1v2w3'),
            _0x1o2p: document.getElementById('x4y5z6'),
            _0x3q4r: document.getElementById('a7b8c9'),
            _0x5s6t: document.getElementById('g4h5i6'),
            _0x7u8v: document.getElementById('j7k8l9'),
            _0x9w0x: document.getElementById('s7t8u9'),
            _0x1y2z: document.getElementById('v1w2x3'),
            _0x3a4b: document.getElementById('e1f2g3'),
            _0x5c6d: document.getElementById('h4i5j6')
        };

        // æ˜¾ç¤ºçŠ¶æ€å‡½æ•°ï¼ˆæ··æ·†ï¼‰
        function _0x7e8f(_0x9g0h, _0x1i2j, _0x3k4l) {
            _0x9g0h.textContent = _0x1i2j;
            _0x9g0h.className = `b1c2d3 e4f5g6 ${_0x3k4l === 'success' ? 'h7i8j9' : 'k1l2m3'}`;
        }

        // æ˜¾ç¤ºæ­¥éª¤å‡½æ•°ï¼ˆæ··æ·†ï¼‰
        function _0x5m6n(_0x7o8p) {
            document.querySelectorAll('.s1t2u3').forEach((_0x9q0r, _0x1s2t) => {
                if (_0x1s2t === _0x7o8p - 1) {
                    _0x9q0r.classList.add('v4w5x6');
                } else {
                    _0x9q0r.classList.remove('v4w5x6');
                }
            });
            _0x1a2b._0x3c4d = _0x7o8p;
        }

        // OAuthç™»å½•å¤„ç†
        _0x3w4x._0x5y6z.addEventListener('click', async function() {
            try {
                this.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>å¯åŠ¨ä¸­...';
                this.disabled = true;
                
                _0x7e8f(_0x3w4x._0x7a8b, "æ­£åœ¨å¯åŠ¨å®‰å…¨OAuthè®¤è¯...", "success");
                
                const _0x3u4v = await SecureAuthService.initiateGiffgaffOAuth();
                
                if (_0x3u4v.success) {
                    _0x1a2b._0x5e6f = _0x3u4v.sessionId;
                    _0x7e8f(_0x3w4x._0x7a8b, "OAuthè®¤è¯å·²å¯åŠ¨ï¼è¯·åœ¨æ–°çª—å£ä¸­å®Œæˆç™»å½•ï¼Œç„¶åå¤åˆ¶å›è°ƒURLã€‚", "success");
                    window.open(_0x3u4v.authUrl, '_blank');
                    setTimeout(() => _0x5m6n(2), 2000);
                } else {
                    throw new Error(_0x3u4v.error || 'OAuthå¯åŠ¨å¤±è´¥');
                }
            } catch (_0x5w6x) {
                _0x7e8f(_0x3w4x._0x7a8b, "OAuthå¯åŠ¨å¤±è´¥ï¼š" + _0x5w6x.message, "error");
            } finally {
                this.innerHTML = '<i class="fas fa-lock me-2"></i>å¯åŠ¨å®‰å…¨ç™»å½•';
                this.disabled = false;
            }
        });

        // å›è°ƒå¤„ç†
        _0x3w4x._0x1e2f.addEventListener('click', async function() {
            try {
                const _0x7y8z = _0x3w4x._0x9c0d.value.trim();
                if (!_0x7y8z) {
                    _0x7e8f(_0x3w4x._0x3g4h, "è¯·è¾“å…¥å›è°ƒURL", "error");
                    return;
                }
                
                this.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>å¤„ç†ä¸­...';
                this.disabled = true;
                
                const _0x9a0b = await SecureAuthService.completeGiffgaffOAuth(_0x7y8z);
                
                if (_0x9a0b.success) {
                    _0x1a2b._0x7g8h = _0x9a0b.accessToken;
                    _0x7e8f(_0x3w4x._0x3g4h, "OAuthè®¤è¯æˆåŠŸï¼", "success");
                    setTimeout(() => _0x5m6n(3), 1500);
                } else {
                    throw new Error(_0x9a0b.error || 'å›è°ƒå¤„ç†å¤±è´¥');
                }
            } catch (_0x1c2d) {
                _0x7e8f(_0x3w4x._0x3g4h, "å›è°ƒå¤„ç†å¤±è´¥ï¼š" + _0x1c2d.message, "error");
            } finally {
                this.innerHTML = '<i class="fas fa-check me-2"></i>å®‰å…¨å¤„ç†å›è°ƒ';
                this.disabled = false;
            }
        });

        // MFAéªŒè¯ç å‘é€
        _0x3w4x._0x5i6j.addEventListener('click', async function() {
            try {
                this.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>å‘é€ä¸­...';
                this.disabled = true;
                
                const _0x3e4f = await SecureAuthService.sendMFACode(_0x1a2b._0x7g8h);
                
                if (_0x3e4f.success) {
                    _0x1a2b._0x9i0j = _0x3e4f.ref;
                    _0x7e8f(_0x3w4x._0x7k8l, "éªŒè¯ç å·²å‘é€åˆ°æ‚¨çš„é‚®ç®±ï¼", "success");
                    document.getElementById('r7s8t9').style.display = 'block';
                } else {
                    throw new Error(_0x3e4f.error || 'MFAå‘é€å¤±è´¥');
                }
            } catch (_0x5g6h) {
                _0x7e8f(_0x3w4x._0x7k8l, "å‘é€å¤±è´¥ï¼š" + _0x5g6h.message, "error");
            } finally {
                this.innerHTML = '<i class="fas fa-paper-plane me-2"></i>å‘é€éªŒè¯ç ';
                this.disabled = false;
            }
        });

        // MFAéªŒè¯ç éªŒè¯
        _0x3w4x._0x1o2p.addEventListener('click', async function() {
            try {
                const _0x7i8j = _0x3w4x._0x9m0n.value.trim();
                if (!_0x7i8j) {
                    _0x7e8f(_0x3w4x._0x3q4r, "è¯·è¾“å…¥éªŒè¯ç ", "error");
                    return;
                }
                
                this.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>éªŒè¯ä¸­...';
                this.disabled = true;
                
                const _0x9k0l = await SecureAuthService.verifyMFACode(_0x1a2b._0x7g8h, _0x7i8j, _0x1a2b._0x9i0j);
                
                if (_0x9k0l.success) {
                    _0x1a2b._0x1k2l = _0x9k0l.signature;
                    _0x7e8f(_0x3w4x._0x3q4r, "éªŒè¯ç éªŒè¯æˆåŠŸï¼", "success");
                    setTimeout(() => _0x5m6n(4), 1500);
                } else {
                    throw new Error(_0x9k0l.error || 'MFAéªŒè¯å¤±è´¥');
                }
            } catch (_0x1m2n) {
                _0x7e8f(_0x3w4x._0x3q4r, "éªŒè¯å¤±è´¥ï¼š" + _0x1m2n.message, "error");
            } finally {
                this.innerHTML = '<i class="fas fa-check me-2"></i>éªŒè¯é‚®ä»¶ç ';
                this.disabled = false;
            }
        });

        // è·å–ä¼šå‘˜ä¿¡æ¯
        _0x3w4x._0x5s6t.addEventListener('click', async function() {
            try {
                this.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>è·å–ä¸­...';
                this.disabled = true;
                
                const _0x3o4p = await SecureAuthService.getMemberInfo(_0x1a2b._0x7g8h, _0x1a2b._0x1k2l);
                
                if (_0x3o4p.success) {
                    _0x7e8f(_0x3w4x._0x7u8v, "ä¼šå‘˜ä¿¡æ¯è·å–æˆåŠŸï¼", "success");
                    document.getElementById('m1n2o3').innerHTML = `
                        <div class="card mt-3">
                            <div class="card-body">
                                <h5>ä¼šå‘˜ä¿¡æ¯</h5>
                                <p><strong>ä¼šå‘˜ID:</strong> ${_0x3o4p.data.memberId}</p>
                                <p><strong>ç”¨æˆ·å:</strong> ${_0x3o4p.data.memberName}</p>
                                <p><strong>æ‰‹æœºå·:</strong> ${_0x3o4p.data.phoneNumber}</p>
                            </div>
                        </div>
                    `;
                    setTimeout(() => _0x5m6n(5), 2000);
                } else {
                    throw new Error(_0x3o4p.error || 'è·å–ä¼šå‘˜ä¿¡æ¯å¤±è´¥');
                }
            } catch (_0x5q6r) {
                _0x7e8f(_0x3w4x._0x7u8v, "è·å–å¤±è´¥ï¼š" + _0x5q6r.message, "error");
            } finally {
                this.innerHTML = '<i class="fas fa-user-check me-2"></i>è·å–ä¼šå‘˜ä¿¡æ¯';
                this.disabled = false;
            }
        });

        // ç”³è¯·eSIM
        _0x3w4x._0x9w0x.addEventListener('click', async function() {
            try {
                this.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>ç”³è¯·ä¸­...';
                this.disabled = true;
                
                // é¢„è®¢eSIM
                const _0x7s8t = await SecureAuthService.reserveESIM(_0x1a2b._0x7g8h, _0x1a2b._0x1k2l);
                if (!_0x7s8t.success) {
                    throw new Error(_0x7s8t.error || 'eSIMé¢„è®¢å¤±è´¥');
                }
                
                // äº¤æ¢SIM
                const _0x9u0v = await SecureAuthService.swapSIM(_0x1a2b._0x7g8h, _0x1a2b._0x1k2l, _0x7s8t.data.ssn);
                if (!_0x9u0v.success) {
                    throw new Error(_0x9u0v.error || 'SIMäº¤æ¢å¤±è´¥');
                }
                
                _0x1a2b._0x3m4n = _0x9u0v.data.ssn;
                _0x7e8f(_0x3w4x._0x1y2z, "eSIMç”³è¯·æˆåŠŸï¼", "success");
                setTimeout(() => _0x5m6n(6), 1500);
                
            } catch (_0x1w2x) {
                _0x7e8f(_0x3w4x._0x1y2z, "ç”³è¯·å¤±è´¥ï¼š" + _0x1w2x.message, "error");
            } finally {
                this.innerHTML = '<i class="fas fa-plus me-2"></i>ç”³è¯·eSIM';
                this.disabled = false;
            }
        });

        // ç”ŸæˆäºŒç»´ç 
        _0x3w4x._0x3a4b.addEventListener('click', async function() {
            try {
                this.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>ç”Ÿæˆä¸­...';
                this.disabled = true;
                
                const _0x3y4z = await SecureAuthService.getESIMToken(_0x1a2b._0x7g8h, _0x1a2b._0x1k2l, _0x1a2b._0x3m4n);
                
                if (_0x3y4z.success) {
                    const _0x5a6b = await SecureAuthService.generateQRCode(_0x3y4z.data.lpaString);
                    
                    if (_0x5a6b.success) {
                        _0x7e8f(_0x3w4x._0x5c6d, "äºŒç»´ç ç”ŸæˆæˆåŠŸï¼", "success");
                        document.getElementById('k7l8m9').innerHTML = `
                            <div class="card mt-3">
                                <div class="card-body text-center">
                                    <h5>eSIMæ¿€æ´»äºŒç»´ç </h5>
                                    <img src="${_0x5a6b.data.qrCodeUrl}" class="img-fluid" alt="eSIM QR Code">
                                    <p class="mt-3"><strong>LPAå­—ç¬¦ä¸²:</strong></p>
                                    <code class="text-break">${_0x3y4z.data.lpaString}</code>
                                </div>
                            </div>
                        `;
                    } else {
                        throw new Error(_0x5a6b.error || 'äºŒç»´ç ç”Ÿæˆå¤±è´¥');
                    }
                } else {
                    throw new Error(_0x3y4z.error || 'eSIMä»¤ç‰Œè·å–å¤±è´¥');
                }
            } catch (_0x7c8d) {
                _0x7e8f(_0x3w4x._0x5c6d, "ç”Ÿæˆå¤±è´¥ï¼š" + _0x7c8d.message, "error");
            } finally {
                this.innerHTML = '<i class="fas fa-qrcode me-2"></i>ç”ŸæˆäºŒç»´ç ';
                this.disabled = false;
            }
        });

        // é¡µé¢å¸è½½æ—¶æ¸…ç†æ•æ„Ÿæ•°æ®
        window.addEventListener('beforeunload', function() {
            SecureAuthService.clearSensitiveData();
        });

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ”’ å®‰å…¨eSIMå·¥å…·å·²åŠ è½½');
            _0x5m6n(1);
        });
    </script>
</body>
</html>